<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Beid - Responsive HTML5 Template</title>

    <!-- CSS -->
    <link href="css/fonts/fontawesome/all.min.css" rel="stylesheet">
    <link href="css/fonts/beid.css" rel="stylesheet">

    <link href="css/main.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- JQVMAP -->
    <link href="plugins/jqvmap/jqvmap.min.css" rel="stylesheet">

    <!-- dateRangePicker -->
    <link href="plugins/daterangepicker/daterangepicker.css" rel="stylesheet">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
    <link rel="icon" href="img/favicon.png">

    <!-- Fonts -->
    <link href="fonts/inter/inter.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="css/pagination.css">

    <!--[if lt IE 9]>
    <script src="http://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="http://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script crossorigin="anonymous" src="https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.js"></script>

    <script src="js/logout.js"></script>
    <script src="js/time.js"></script>
    <script src="js/welcome.js"></script>
    <script src="url.js"></script>
    <!-- import element-ui CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- import layui CSS -->
    <link rel="stylesheet" href="plugins/layui/css/layui.css">
    <!-- 查看图片 -->
    <link rel="stylesheet" href="css/imageBox.css">

    <style>
        /*将不可点击的按钮置灰*/
        .disabled_btn {
            opacity: 0.5;
        }
    </style>
</head>

<body class="body" background="img/bg1.png">
<div id="app">

    <!-- main content -->
    <div class="main-container">
        <div class="overflow-hidden">
            <!-- eCommerce -->
            <div id="card">
                <!-- content-container -->
                <div class="container-fluid p-0">
                    <!-- panel-status -->
                    <div class="panel-row row no-gutters">

                        <!-- panel-col -->
                        <div class="panel-col col-xl-12 col-lp-12 panel-pt-col">
                            <!-- panel -->
                            <div class="panel">
                                <div class="panel-header align-items-center">
                                    <div class="input-group" style="width: 20%;margin-right: 30px">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">用户名</span>
                                        </div>
                                        <el-input v-model="searchMap.name" style="" placeholder="请输入用户名"></el-input>
                                    </div>

                                    <button class="btn btn-outline-primary" @click="searchMap.pageNum=1;search();" style="font-size: 0.8rem">
                                        <i class="fas fa-search mr-1"></i>搜索
                                    </button>
                                </div>

                                <div class="pl-4 pl-md-7">
                                    <a href="#" @click="admin_add('添加','useradd.html','800','520')" class="btn btn-primary"><span class="d-block">添加用户</span></a>
                                </div>
                                <div class="collapse show" id="collapseRecentOrders">
                                    <div class="panel-body pr-0">
                                        <div class="pr-4">
                                            <div class="panel-list-sc list-unstyled" data-scrollbar="scroll" tabindex="1" style="overflow: hidden; outline: none;height: 29rem">
                                                <div class="pr-5">
                                                    <table class="table table-borderless mb-0" style="font-size: 1rem !important;">
                                                        <thead>
                                                        <tr>
                                                            <th scope="col" class="pt-0">
                                                                用户名
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                真实姓名
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                手机号码
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                电子邮箱
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                角色
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                备注
                                                            </th>
                                                            <th scope="col" class="pt-0">
                                                                操作
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr v-for="(community,index) in communityList" style="padding: 0.8rem">
                                                            <td style="padding: 0.8rem">{{community.userName}}</td>
                                                            <td style="padding: 0.8rem">{{community.realName}}</td>
                                                            <td style="padding: 0.8rem">{{community.phone}}</td>
                                                            <td style="padding: 0.8rem">{{community.email}}</td>
                                                            <td style="padding: 0.8rem">
                                                                <a href="#" class="btn btn-sm btn-outline-warning btn-round px-4">{{community.roleKey}}</a>
                                                            </td>
                                                            <td style="padding: 0.8rem">{{community.remarks}}</td>
                                                            <td>
                                                                <!--根据用户的type字段(INIT/CREATE) 判断是否赋予编辑和删除的权限-->
                                                                <a :title="community.type == 'INIT' ? '管理员数据不可以编辑' : '编辑'" href="javascript:;"
                                                                   @click="community.type == 'INIT' ? '' : community_edit('编辑','useradd.html',community.id,'800','520')"
                                                                   :class="community.type == 'INIT' ? 'disabled_btn' : ''"
                                                                   style="text-decoration:none">
                                                                    <i class="layui-icon">&#xe642;</i>
                                                                </a>
                                                                <a :title="community.type == 'INIT' ? '管理员数据不可以删除' : '删除'" href="javascript:;"
                                                                   @click="community.type == 'INIT' ? '' : del_one(community.id)"
                                                                   :class="community.type == 'INIT' ? 'disabled_btn' : ''"
                                                                   style="text-decoration:none">
                                                                    <i class="layui-icon">&#xe640;</i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <el-pagination
                                                    background
                                                    @size-change="handleSizeChange"
                                                    @current-change="handleCurrentChange"
                                                    :page-size="searchMap.pageSize"
                                                    layout="prev, pager, next,sizes"
                                                    :page-sizes="[4,8]"
                                                    style="text-align: right;"
                                                    :total="total">
                                            </el-pagination>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.panel -->
                        </div>
                        <!-- ./panel-col -->
                    </div>
                    <!-- /.panel-status -->
                </div>
                <!-- /.content-container -->
            </div>
            <!-- /.eCommerce -->
            <!-- footer -->
            <footer id="footer" class="footer">
                <div class="container-fluid">
                    <div class="row gutters-y align-items-center">
                        <div class="col-md-6 col-lg-5">
                            <div class="px-3 fw-400">
                                © 2019 BEID.
                                All rights <a href="http://www.bootstrapmb.com/" title="bootstrapmb">Reserved</a>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-7 order-lg-last d-none d-md-block">
                            <div class="nav nav-bold-style justify-content-end text-uppercase px-2">
                                <a class="nav-link" href="#">Terms of use</a>
                                <a class="nav-link" href="#">Privacy Policy</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- /.footer -->
        </div>
    </div>

</div>
</body>
<!-- import Vue before element-ui -->
<script src="https://unpkg.com/vue@2/dist/vue.js"></script>
<!-- import element-ui -->
<script src="https://unpkg.com/element-ui@2.15.8/lib/index.js"></script>
<!-- import layui -->
<script src="plugins/layui/layui.js"></script>
<!-- jQuery -->
<script src="js/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.min.js"></script>

<!-- Chart.js -->
<script src="plugins/chart/Chart.min.js" id="_chartJS_min"></script>
<script src="plugins/chart/Chart.bundle.min.js"></script>
<script src="plugins/chart/chartjs-plugin-annotation.js"></script>
<script src="plugins/chart/chartjs-plugin-labels.js"></script>

<!-- apexcharts -->
<script src="plugins/apexcharts/apexcharts.min.js"></script>
<!-- Moment -->
<script src="plugins/lib/moment/moment.min.js"></script>
<!-- User JS -->
<script src="js/scripts.js"></script>
<!-- Main JS -->
<script src="js/main.js" id="_mainJS" data-plugins="load"></script>
<!-- Modules -->
<script src="js/modules.js"></script>

<script>
    var app = new Vue({
            el: "#app",//声明当前Vue在页面的作用域
            data: {
                checkedIDs: [],
                communityList: [],
                total: 10,
                searchMap: {"name": "", "pageNum": 1, "pageSize": 8},
                selectDate: ['', ''],
                roleKeyMap: {"ADMIN": "系统管理员", "ROOT": "厂家管理员", "USER": "系统用户", "VISITOR": "访客用户",}
            },
            methods: {
                //分页条件查询用户列表
                search() {
                    axios.post(apiPath + "/user/searchCondition", this.searchMap).then((res) => {
                        app.communityList = res.data.data;
                        app.total = res.data.total;
                    });
                },
                //单个删除
                del_one(id) {
                    this.$confirm('请问您是否要删除该用户信息?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        //把选中的ID封装到集合中
                        this.checkedIDs.push(id);
                        //执行删除操作
                        axios.post(apiPath + "/user/del", this.checkedIDs).then((res) => {
                            if (res.data.flag) {
                                this.$message({
                                    type: 'success',
                                    message: '删除成功!'
                                });
                            }
                            //删除成功，把选中的ID列表置为空
                            this.checkedIDs = [];
                            //把页面置为1，重新获取列表数据
                            this.searchMap.pageNum = 1;
                            this.search();
                        });

                    }).catch(() => {
                        this.$message({
                            type: 'info',
                            message: '已取消删除'
                        });
                    });
                },
                //handleSizeChange每页数量发生变化后触发的方法
                handleSizeChange(pageSize) {
                    this.searchMap.pageSize = pageSize;
                    this.search();
                }
                ,
                //handleCurrentChange页码变化触发方法
                handleCurrentChange(pageNum) {
                    this.searchMap.pageNum = pageNum;
                    this.search();
                }
                ,
                //日期格式化方法
                //date 要进行格式的日期 ；format 格式化的样式
                dateFormat(date, format) {
                    //默认格式化字符串"YYYY-MM-DD HH:mm:ss"
                    if (format == null || format == '') {
                        format = "YYYY-MM-DD HH:mm:ss";
                    }
                    return moment(date).format(format);
                }
                ,
                /*添加*/
                admin_add(title, url, w, h) {
                    this.x_admin_show(title, url, w, h);
                }
                ,
                //编辑
                community_edit(title, url, id, w, h) {
                    url = url + "?id=" + id;
                    this.x_admin_show(title, url, w, h);
                }
                ,
                /*弹出层*/
                /*
                    参数解释：
                    title	标题
                    url		请求的url
                    id		需要操作的数据id
                    w		弹出层宽度（缺省调默认值）
                    h		弹出层高度（缺省调默认值）
                */
                x_admin_show(title, url, width, height) {
                    if (title == null || title == '') {
                        title = false;
                    }
                    ;
                    if (url == null || url == '') {
                        url = "404.html";
                    }
                    ;
                    if (width == null || width == '') {
                        width = 800;
                    }
                    ;
                    if (height == null || height == '') {
                        height = ($(window).height() - 50);
                    }
                    ;

                    layer.open({
                        type: 2,
                        area: [width + 'px', height + 'px'],
                        fix: false, //不固定
                        maxmin: true,
                        shadeClose: true,
                        shade: 0.4,
                        title: title,
                        content: url,
                        cancel: function (index, layero) {
                            //使用右上角x关闭弹窗层，回调方法，重新加载页面数据，让修改或者新增的数据立马显示在页面上
                            app.search();
                        }
                    });
                }
                ,
                /*关闭弹出框口*/
                x_admin_close() {
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                }
            },
            created: function () {//Vue生命周期方法，加载页面时会执行该方法
                layui.use(['laydate', 'element', 'laypage', 'layer'], function () {
                    $ = layui.jquery;//jquery
                    layer = layui.layer;//弹出层
                    layer.ready(function () { //为了layer.ext.js加载完毕再执行
                        layer.photos({
                            photos: '#x-img'
                        });
                    });
                });
                //初始页面获取用户列表信息
                this.search();
            }
        })
    ;

</script>

</html>