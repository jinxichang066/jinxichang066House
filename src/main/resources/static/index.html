<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>气体遥测监测预警系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="old/css/main.css" media="all">
    <link rel="stylesheet" href="old/css/font.css">
</head>

<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header header header-demo">
        <div class="layui-main">
            <div class="admin-logo-box">
                <div class="larry-side-menu">
                    <img src="old/images/ss.png" width="44px" height="44px" alt="">
                </div>
                <img src="old/images/logo.svg" class="logo" width="183px" alt="">
            </div>

            <ul class="layui-nav" lay-filter="">
                <li class="layui-nav-item" id="time" style="margin-right: 50px;font-weight: 300;font-size: 16px;color: #fff;position: absolute;left: -250px;top: 0"></li>
                <li class="layui-nav-item"><img src="img/avatar/user_head.jpg" class="layui-circle" width="35px" height="35px" alt=""></li>

                <li class="layui-nav-item"><a href="javascript:;">admin</a>
                    <dl class="layui-nav-child">
                        <!-- 二级菜单 -->
                        <dd><a href="javascript:;" onclick="one_set('个人信息','one_set.html','1000','600')">个人信息</a>
                        </dd>
                        <dd><a href="">切换帐号</a></dd>
                        <dd><a href="javascript:;" onclick="logout()">退出</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item x-index"><a href="#"></a></li>
            </ul>
        </div>
    </div>

    <!--左侧导航区域-->
    <div class="layui-side layui-bg-black x-side show_list" style="left:0px;" id="table1">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree site-demo-nav" lay-filter="side">
                <li class="layui-nav-item layui-nav-itemed"><a class="javascript:;" href="javascript:;"> <i class="fa fa-camera"></i><cite>实时监控</cite> </a>
                    <dl id="dlMachineList" class="layui-nav-child">
                        <!--                        <dd class="layui-this"><a href="javascript:;" _href="welcome.html?id=516b98016fb0faf142e890e6b63db900"> <cite>1号设备</cite> </a></dd>-->
                        <!--                        <dd class=""><a href="javascript:;" _href="welcome.html?id=e6f277f22f5bb863213ffe756e3818d9"> <cite>2号设备</cite> </a></dd>-->
                    </dl>
                </li>
                <li class="layui-nav-item"><a class="javascript:;" href="javascript:;" _href="history.html"> <i class="fa fa-history"></i><cite>历史记录</cite>
                </a>
                </li>
                <li class="layui-nav-item"><a class="javascript:;" href="javascript:;"> <i class="fa fa-cogs"></i><cite>系统设置</cite> </a>
                    <dl class="layui-nav-child">
                        <dd class=""><a href="javascript:;" _href="machine.html"> <cite>设备管理</cite> </a></dd>
                        <dd class=""><a href="javascript:;" _href="system.html"> <cite>出厂配置</cite> </a></dd>
                        <dd class=""><a href="javascript:;" _href="user.html"> <cite>用户管理</cite> </a></dd>
                        <dd class=""><a href="javascript:;" _href="one_set.html"> <cite>个人设置</cite> </a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item" style="height: 30px; text-align: center"></li>
            </ul>
        </div>
    </div>

    <div class="layui-tab layui-tab-card site-demo-title x-main" lay-filter="x-tab" lay-allowclose="true" style="left: 220px;border-left: solid 2px #2299ee; background:url(img/bg1.png) no-repeat">
        <!--        2020.05.18 客户不需要多选项卡功能，并且删除选项卡栏-->
        <!--        1.隐藏选项卡头tabTitle栏:display: none。 2.main.js中监听导航点击:通过清空layui的tabTitle和tabContent实现系统只支持单选项卡的效果-->
        <ul id="tabTitle" class="layui-tab-title" style="display: none">
            <!--            <li class="layui-this"> 实时监控 <i class="layui-icon layui-unselect layui-tab-close">ဆ</i></li>-->
        </ul>
        <div id="tabContent" class="layui-tab-content site-demo site-demo-body">
            <!--                        <div class="layui-tab-item layui-show">-->
            <!--                            <iframe frameborder="0" src="welcome.html?id=516b98016fb0faf142e890e6b63db900" class="x-iframe"></iframe>-->
            <!--                        </div>-->
        </div>
    </div>
    <div class="site-mobile-shade"></div>
</div>

<!--引入Axios js脚本-->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="url.js"></script>
<script src="old/js/jquery.min.js"></script>
<script type="text/javascript" src="old/lib/loading/okLoading.js"></script>
<script src="old/lib/layui/layui.js" charset="utf-8"></script>
<script src="old/js/main.js"></script>
<script src="old/js/x-layui.js" charset="utf-8"></script>
<script src="js/time.js"></script>
<script src="js/auth.js"></script>

<script>
    function getMachineState(machineState) {
        if (machineState === "ONLINE") {
            return "在线";
        } else {
            return "离线";
        }
    }
</script>

<script>
    // 初始化菜单中的设备列表，用同步的方式，防止设备列表未加载完毕，layui组件就生效了导致后续菜单切换不可用
    $.ajaxSettings.async = false;

    $.ajax({
        type: "post",
        url: apiPath + "/machine/searchAll",
        beforeSend: function (xhr) {
            xhr.setRequestHeader('gasToken', getGasToken());
        },
        data: {},
        dataType: "json",
        success: function (res) {
            // 验证登录状态
            doAuth(res);

            let machineList = res.data;
            if (machineList.length !== 0) {
                //菜单
                let dlMachineList = document.getElementById("dlMachineList");
                let dd = '';
                for (let i = 0; i < machineList.length; i++) {
                    let machine = machineList[i];
                    if (i === 0) {
                        dd += '<dd class="layui-this"><a href="javascript:;" _href="welcome.html?id=' + machine.id + '"> <cite>' + machine.machineName + ' [' + getMachineState(machine.state) + ']' +
                            '</cite> </a></dd>';
                    } else {
                        dd += '<dd class=""><a href="javascript:;" _href="welcome.html?id=' + machine.id + '"> <cite>' + machine.machineName + ' [' + getMachineState(machine.state) + ']' +
                            ' </cite> </a></dd>';
                    }
                }
                dlMachineList.innerHTML = dd;

                //tabContent
                let tabContent = document.getElementById("tabContent");
                let firstMachine = machineList[0];
                tabContent.innerHTML = '<div class="layui-tab-item layui-show"><iframe frameborder="0" src="welcome.html?id=' + firstMachine.id + '" class="x-iframe"></iframe></div>';
            }
        }
    })

</script>


<script>

    layui.use(['laydate', 'element', 'laypage', 'layer'], function () {
        $ = layui.jquery;//jquery
        laydate = layui.laydate;//日期插件
        lement = layui.element();//面包导航
        laypage = layui.laypage;//分页
        layer = layui.layer;//弹出层
        okLoading.close($)
        //以上模块根据需要引入

    });

    /**
     * 退出登陆
     * 2019年8月17日19:43:15
     */
    function logout() {

        // $.ajax({
        //     type: "post",
        //     url: "xxxxx",
        //     data: {e: 1},
        //     dataType: "json",
        //     success: function (data) {
        //         if (data.status == 1) {
        //             layer.msg(data.info, {icon: 1, time: 1000});
        //             setTimeout("window.location.href='xxxx'", 2000);
        //             return false;
        //             return false;
        //         } else {
        //             layer.msg(data.info, {icon: 5, time: 2000});
        //             return false;
        //         }
        //     }
        //
        // })
        // return false;

        location.href = "login.html";

    }

    function one_set(title, url, w, h) {
        x_admin_show(title, url, w, h);
    }
</script>

</body>
</html>